{% extends "layout.html" %}

{% block page_title %}Profit & Loss Statement{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center no-print">
    <p class="text-slate-500">Period: {{ start_date.strftime('%B %Y') }}</p>
    <button onclick="window.print()"
        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow-md hover:bg-blue-700 transition-all flex items-center">
        <i data-lucide="printer" class="w-4 h-4 mr-2"></i> Print P&L
    </button>
</div>

<div
    class="max-w-4xl mx-auto bg-white p-12 rounded-xl border border-slate-200 shadow-sm print:shadow-none print:border-none">
    <div class="text-center mb-12">
        <h1 class="text-3xl font-black text-slate-900 uppercase">
            {{ system_settings.company_name if system_settings else 'WON SOLUTIONS' }}
        </h1>
        <h2 class="text-xl font-bold text-slate-600">INCOME STATEMENT</h2>
        <p class="text-slate-400">For the period {{ start_date.strftime('%d %b %Y') }} to {{ end_date.strftime('%d %b
            %Y') }}</p>
    </div>

    <div class="space-y-6">
        <!-- Revenue -->
        <div class="border-b-2 border-slate-900 pb-2">
            <div class="flex justify-between items-end">
                <h3 class="text-lg font-black uppercase text-slate-900">REVENUE</h3>
                <p class="text-xl font-black">{{ system_settings.currency if system_settings else 'LKR' }} {{
                    "%.2f"|format(sales_mtd) }}</p>
            </div>
            {% if vat_collected > 0 %}
            <div class="flex justify-between items-end text-sm text-slate-500 mt-1">
                <span>Less: VAT Collected (Income)</span>
                <span>({{ "%.2f"|format(vat_collected) }})</span>
            </div>
            <div class="flex justify-between items-end text-sm font-bold text-slate-700 mt-1">
                <span>Net Trading Income</span>
                <span>{{ "%.2f"|format(revenue_mtd) }}</span>
            </div>
            {% endif %}
        </div>

        <!-- COGS -->
        <div class="pb-2 flex justify-between items-end text-red-600 border-b border-slate-100">
            <h3 class="text-sm font-bold uppercase">Less: Cost of Goods Sold</h3>
            <p class="text-lg font-bold">({{ "%.2f"|format(cogs_mtd) }})</p>
        </div>

        <div class="pt-2 flex justify-between items-end bg-slate-50 p-2">
            <h3 class="text-sm font-black uppercase text-slate-700">GROSS PROFIT</h3>
            <p class="text-xl font-black text-slate-900">{{ system_settings.currency if system_settings else 'LKR' }} {{
                "%.2f"|format(gross_profit) }}</p>
        </div>

        <!-- Operating Expenses -->
        <div class="pt-4">
            <h3 class="text-sm font-black uppercase text-slate-900 border-b border-slate-200 pb-2 mb-4">Operating
                Expenses</h3>
            <div class="flex justify-between items-end mb-2 text-slate-600">
                <span>Business Expenses (Excl. VAT)</span>
                <span>{{ "%.2f"|format(expenses_mtd) }}</span>
            </div>
            {% if vat_paid > 0 %}
            <div class="flex justify-between items-end text-sm text-slate-500 italic">
                <span>VAT Paid on Expenses (Recoverable/Input)</span>
                <span>{{ "%.2f"|format(vat_paid) }}</span>
            </div>
            {% endif %}

            <div class="border-t border-slate-200 mt-4 pt-2 flex justify-between items-end">
                <h3 class="text-sm font-black uppercase text-slate-900">NET PROFIT BEFORE TAX</h3>
                <p class="text-xl font-black">{{ "%.2f"|format(net_profit_before_tax) }}</p>
            </div>

            <div class="flex justify-between items-end mt-2 text-red-600">
                <span class="text-xs font-bold font-mono">INCOME TAX PROVISION (30%)</span>
                <span>({{ "%.2f"|format(tax_provision) }})</span>
            </div>

            <div class="border-t-2 border-slate-900 mt-4 pt-2 flex justify-between items-end">
                <h3 class="text-lg font-black uppercase text-slate-900">NET PROFIT AFTER TAX</h3>
                <p class="text-2xl font-black text-green-600">
                    {{ system_settings.currency if system_settings else 'LKR' }} {{ "%.2f"|format(net_profit_after_tax)
                    }}
                </p>
            </div>
        </div>
    </div>

    <div class="mt-24 text-center border-t border-slate-200 pt-8">
        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">
            Prepared by System â€“ Subject to Auditor Verification
        </p>
        <p class="text-[10px] text-slate-400 italic">
            This is a computer-generated report for {{ system_settings.company_name if system_settings else 'WON
            SOLUTIONS' }} internal and compliance support purposes.
        </p>
    </div>
</div>

<style>
    @media print {
        .no-print {
            display: none !important;
        }

        body {
            background: white;
        }

        header,
        aside {
            display: none !important;
        }

        main {
            padding: 0 !important;
            margin: 0 !important;
        }

        .p-8 {
            padding: 0 !important;
        }
    }
</style>
{% endblock %}