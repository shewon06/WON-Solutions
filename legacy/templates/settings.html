{% extends "layout.html" %}

{% block page_title %}System Settings{% endblock %}

{% block content %}
<div class="max-w-2xl bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-slate-200 bg-slate-50">
        <h3 class="font-bold text-slate-800">Company Information</h3>
    </div>
    <form action="{{ url_for('settings.manage_settings') }}" method="POST" class="p-6 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Company Name</label>
                <input type="text" name="company_name" value="{{ settings.company_name if settings else '' }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Company Tagline</label>
                <input type="text" name="tagline" value="{{ settings.tagline if settings else '' }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">ROC Number</label>
                <input type="text" name="roc_number" value="{{ settings.roc_number if settings }}"
                    placeholder="PV-XXXXXX"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">TIN Number</label>
                <input type="text" name="tin_number" value="{{ settings.tin_number if settings }}"
                    placeholder="XXXXXXXXX"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">VAT Number (if applicable)</label>
                <input type="text" name="vat_number" value="{{ settings.vat_number if settings }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="flex items-center space-x-2 pt-6">
                <input type="checkbox" name="is_vat_registered" id="is_vat_registered" {{ 'checked' if settings and
                    settings.is_vat_registered }}
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <label for="is_vat_registered" class="text-sm font-semibold text-slate-700">VAT Registered
                    Company</label>
            </div>
            <div class="col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Nature of Business (for IRD)</label>
                <textarea name="nature_of_business" rows="2"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">{{ settings.nature_of_business if settings }}</textarea>
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Registered Address</label>
                <textarea name="address" rows="2" placeholder="Street, City, Postal Code"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">{{ settings.registered_address if settings }}</textarea>
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Primary Phone</label>
                <input type="text" name="phone" value="{{ settings.contact_phone if settings }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Contact Email</label>
                <input type="email" name="email" value="{{ settings.contact_email if settings }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Country</label>
                <input type="text" name="country" value="{{ settings.country if settings else 'Sri Lanka' }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Currency</label>
                <input type="text" name="currency" value="{{ settings.currency if settings else 'LKR' }}"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Website Domain</label>
                <input type="url" name="website_domain" value="{{ settings.website_domain if settings }}"
                    placeholder="https://won.systems"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-1">Financial Year End</label>
                <select name="financial_year_end"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="March" {{ 'selected' if settings and settings.financial_year_end=='March' }}>March
                    </option>
                    <option value="December" {{ 'selected' if settings and settings.financial_year_end=='December' }}>
                        December</option>
                </select>
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-semibold text-slate-700 mb-1">Receipt Footer Message</label>
                <textarea name="receipt_footer" rows="2" placeholder="Thank you for your business!"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">{{ settings.receipt_footer if settings }}</textarea>
            </div>

            <!-- Daraz API Integration -->
            <div class="col-span-2 pt-6 mt-6 border-t border-slate-100">
                <h4 class="font-bold text-slate-800 mb-4 flex items-center">
                    <i data-lucide="api" class="w-4 h-4 mr-2"></i> Daraz API Integration
                </h4>
                <div
                    class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-orange-50/50 p-4 rounded-xl border border-orange-100">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Daraz App Key</label>
                        <input type="text" name="daraz_app_key" value="{{ settings.daraz_app_key if settings }}"
                            placeholder="Enter App Key"
                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Daraz App Secret</label>
                        <input type="password" name="daraz_app_secret"
                            value="{{ settings.daraz_app_secret if settings }}" placeholder="Enter App Secret"
                            class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none">
                    </div>
                    <div class="col-span-2 text-xs text-slate-500 italic mt-2 flex justify-between items-center">
                        <p>To use auto-sync, you need to register your app on the <a href="https://open.daraz.com/"
                                target="_blank" class="text-orange-600 hover:underline">Daraz Open Platform</a>.</p>
                        {% if settings.daraz_app_key and settings.daraz_app_secret %}
                        <div class="flex items-center">
                            {% if settings.daraz_access_token %}
                            <span class="text-green-600 font-bold mr-3 flex items-center">
                                <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Connected
                            </span>
                            {% endif %}
                            <a href="{{ url_for('settings.connect_daraz') }}"
                                class="bg-orange-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-700 transition-all text-sm">
                                {{ 'Re-connect Daraz' if settings.daraz_access_token else 'Connect to Daraz' }}
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="pt-6 border-t border-slate-100 flex justify-between items-center">
            <a href="{{ url_for('backup.run_backup') }}"
                class="text-sm font-semibold text-blue-600 hover:underline flex items-center">
                <i data-lucide="database" class="w-4 h-4 mr-1"></i> Trigger Manual Backup
            </a>
            <button type="submit"
                class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-blue-700 transition-all">
                Save System Settings
            </button>
        </div>
    </form>
</div>
{% endblock %}